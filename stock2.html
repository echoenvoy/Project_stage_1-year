<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Stock Management</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="Style.css">
</head>
<body>
  <!--header-->
  <div id="header"></div>

  <!-- Products Page -->
    
    
      <a href="main2.html" class="back-btn" >
      <i class="fas fa-arrow-left"></i> Back to dashboard
      </a>
      <div class="section">
        <div class="section-header">
          <h2 class="section-title">Product Management</h2>
          <div class="section-actions">
            <button class="btn btn-outline">
              <i class="fas fa-filter"></i> Filter
            </button>
            <button  onclick="location.href='#product-form'" class="btn btn-primary" id="add-product-btn">
              <i class="fas fa-plus"></i> Add Product
            </button>
          </div>
        </div>
        <div class="table-container">
           <h2>Products in stock</h2>
            <table class="data-table">
              <thead>
                <tr>
                  <th>Name</th><th>Ref</th><th>Qty</th><th>Price</th><th>Date</th><th>Actions</th>
                </tr>
              </thead>
              <tbody id="stockTable_tb"></tbody>
            </table>
         
        </div>
      </div>
      
      <div class="section">
        <div class="section-header">
          <h2 class="section-title">Add a product</h2>
        </div>
        <form id="product-form" class="product-form">
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="name">Name Product</label>
              <input type="text" id="name" class="form-input" placeholder="Enter the name of product">
            </div>
            <div class="form-group">
              <label class="form-label" for="ref">Reference</label>
              <input type="text" id="ref" class="form-input" placeholder="Enter the reference">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label class="form-label" for="qty">Quantity</label>
              <input type="number" id="qty" class="form-input" placeholder="Quantity in stock">
            </div>
            <div class="form-group">
              <label class="form-label" for="price">Unit price(DH)</label>
              <input type="number" id="price" class="form-input" placeholder="Unit price">
            </div>
            <div class="form-group">
              <label class="form-label" for="date_added">Date Added</label>
              <input type="date" id="date_added" class="form-input">
            </div>
          </div>
          
          <div class="form-group">
            <button onclick="addProduct()" id="myButton"  type="button" class="btn btn-primary">
              <i class="fas fa-plus"></i> Add
            </button>
          </div>
        </form>
      </div>
    
    
  <script>
    fetch("header.html")
    .then(response => response.text())
    .then(data => {
      document.getElementById("header").innerHTML = data;
    });

    let editIndex = -1;
    const btn = document.getElementById("myButton");

    function getStock() {
      return JSON.parse(localStorage.getItem("stock")) || [];
    }

    function saveStock(stock) {
      localStorage.setItem("stock", JSON.stringify(stock));
    }

    function addProduct() {
      const name = nameInput.value.trim();
      const ref = refInput.value.trim();
      const qty = parseInt(qtyInput.value);
      const price = parseFloat(priceInput.value);
      const date_added = dateInput.value;

      if (!name || !ref || isNaN(qty) || isNaN(price) || !date_added) {
        alert("Veuillez remplir tous les champs.");
        return;
      }

      const stock = getStock();

      if (editIndex === -1) {
        stock.push({ name, ref, qty, price, date_added });
      } else {
        stock[editIndex] = { name, ref, qty, price, date_added };
        editIndex = -1;
      }

      saveStock(stock);
      renderStock();
      nameInput.value = refInput.value = qtyInput.value = priceInput.value = dateInput.value = "";
    }

    function renderStock() {
      const stock = getStock();
      if (stock.length === 0) {
          stockTable.innerHTML = `
            <tr>
              <td colspan="6" style="text-align: center; padding: 20px; color: #6c757d;">
                <i class="fas fa-box-open" style="font-size: 3rem; margin-bottom: 10px;"></i>
                <p>No products in stock. Add your first product!</p>
              </td>
            </tr>
          `;
          return;
        }
      stockTable.innerHTML = "";
      stock.forEach((item, index) => {
        stockTable.innerHTML += `
          <tr>
            <td>${item.name}</td>
            <td>${item.ref}</td>
            <td>${item.qty}</td>
            <td>${item.price} DH</td>
            <td>${item.date_added}</td>
            <td class="action-cell">
              <button class="action-btn edit-btn" onclick="editProduct(${index})"><i class="fas fa-edit"></i></button>
              <button class="action-btn delete-btn" onclick="deleteProduct(${index})"><i class="fas fa-trash"></i></button>
            </td>
          </tr>`;
      });
      btn.innerText = "Add ";
    }

    function deleteProduct(index) {
      const stock = getStock();
      if (confirm("Voulez-vous vraiment supprimer ce produit ?")) {
        stock.splice(index, 1);
        saveStock(stock);
        renderStock();
      }
    }

    function editProduct(index) {
      const stock = getStock();
      const product = stock[index];
      

      nameInput.value = product.name;
      refInput.value = product.ref;
      qtyInput.value = product.qty;
      priceInput.value = product.price;
      dateInput.value = product.date_added;

      editIndex = index;
      btn.innerText = "Edit ";

    }

    const nameInput = document.getElementById("name");
    const refInput = document.getElementById("ref");
    const qtyInput = document.getElementById("qty");
    const priceInput = document.getElementById("price");
    const dateInput = document.getElementById("date_added");
    const stockTable = document.getElementById("stockTable_tb");

    renderStock();
  </script>

  <script src="script.js"></script>
</body>
</html>
